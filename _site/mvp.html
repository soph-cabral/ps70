<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1, width=device-width">
  <link rel="icon" type="image/png" href="static/imgs/favicon.png">

  <!-- Correct relative paths to stylesheets -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous"> 
  <link href="static/styles.scss" rel="stylesheet">
   <link href="/static/skeleton/normalize.css" rel="stylesheet">
   <link href="/static/skeleton/skeleton.css" rel="stylesheet">
   <style>.max-height {
    max-height: 350px; /* Maximum height of container */
    width: 100%; /* Ensure the image fills the entire container width */
    object-fit: cover; /* Cover the entire container while maintaining aspect ratio */
  }
  .min-height {
    min-height: 250px; /* Maximum height of container */
    width: 300%; /* Ensure the image fills the entire container width */
    object-fit: cover; /* Cover the entire container while maintaining aspect ratio */
  }
  .scaled-down {
    max-width: 400px; /* Adjust the maximum width of the first image */
    width: 100%; /* Ensure the image fills the entire container width */
}

    .scaled-down2 {
        max-width: 200px; /* Adjust the maximum width of the first image */
        width: 110%; /* Ensure the image fills the entire container width */
        height: 400px; /* Maintain aspect ratio */
    }

    .scaled-up {
        min-width: 700px;
        width: 100%; 
        height: auto; 
    }

    .container p{
        margin-top: 20px !important; 
    }
  </style>
   
   


  <title>ps70</title>

</head>

<body>

  <nav class="navbar navbar-light">
    <div class="container-fluid">
        <!-- Brand with image in a small box -->
        <div class="navbar-brand-box">
            <a href="index.html"><img class="navbar-brand-img" src="static/imgs/logo3.png" alt="Brand Image"></a>
        </div

        <!-- Navigation links directly in the navbar -->
        <ul class="navbar-nav ms-auto mt-2 d-flex flex-row">
            <li class="nav-item me-5"><a class="nav-link" href="/about.html">Sophia Cabral</a></li>
        </ul>
    </div>
</nav>



<div class="container">

    <body>

       <!-- columns should be the immediate child of a .row -->
       <div class="row">
        <div class="twelve columns">
            <h3>MVP</h3>
        </div>
        </div>

        <div class="container">
            <div class="row">
                
                <h5>Serial Communication + Drawing simple geometries</h5>

            </div>
            <p> I began by creating a communication between processing and Arduino in order to create a Visual Interface. The code below shows the Arduino code to send a serial read from a potentiometer to Processing: <xmp>
                // This sketch reads analog data on A0 and sends it out to 
                // the serial port with each sample terminated by a new line "\n"
                // The Processing sketch can then parse the data and plot it graphically.
                
                void setup() {
                  Serial.begin(9600);
                }
                
                void loop() {
                  Serial.print(analogRead(A0));
                  Serial.print("\n");
                  delay(5);
                }
                
                
                 
                }</xmp>
            </p>
            <p> The processing code: <xmp>
                Serial myPort;        // The serial port
                float inByte;         // Incoming serial data
                boolean newData = false;
                int xPos = 1;         // horizontal position of the graph 
                PrintWriter output;   // For writing to a file
                String filepath = "C:/Harvard/ps70/07.MVP/CSV"; // Specify your file path here
                String filename = "data.csv"; // File name
                
                //Variables to draw a continuous line.
                int lastxPos=1;
                int lastheight=0;
                
                void setup () {
                  // set the window size:
                  size(600, 400);        
                  
                  myPort = new Serial(this, "COM4", 9600);  
                
                  // A serialEvent() is generated when a newline character is received :
                  myPort.bufferUntil('\n');
                  background(0);      // set initial background:
                
                  // Initialize PrintWriter for writing to file
                  output = createWriter(filepath + filename);
                  // Write header to CSV file
                  output.println("xPos, inByte");
                }
                
                void draw () {
                  if (newData) {
                    // Write data to CSV file
                    output.println(xPos + ", " + inByte);
                    output.flush(); // Flush the buffer to ensure data is written immediately
                    
                    //Drawing a line from Last inByte to the new one.
                    stroke(127,34,255);     //stroke color
                    strokeWeight(4);        //stroke wider
                    line(lastxPos, lastheight, xPos, height - inByte); 
                    lastxPos= xPos;
                    lastheight= int(height-inByte);
                
                    // at the edge of the window, go back to the beginning:
                    if (xPos >= width) {
                      xPos = 0;
                      lastxPos= 0;
                      background(0);  //Clear the screen.
                    } 
                    else {
                      // increment the horizontal position:
                      xPos++;
                    }
                    newData =false;
                  }
                }
                
                void serialEvent (Serial myPort) {
                  // get the ASCII string:
                  String inString = myPort.readStringUntil('\n');
                  if (inString != null) {
                    inString = trim(inString);                // trim off whitespaces.
                    inByte = float(inString);           // convert to a number.
                    inByte = map(inByte, 0, 1023, 0, height); //map to the screen height.
                    newData = true; 
                  }
                }
                
                void keyPressed() {
                  // Close the output file when any key is pressed
                  output.flush();
                  output.close();
                  println("File saved!");
                }</xmp>
            </p>
            <p> I then proceeded to save my values from my potentiometer to a csv file, which is read in grasshopper. This is a done as a method to translate data to sentences and x,y,z coordinates.<xmp>
                // Read all lines from the CSV file
            string[] csvLines = System.IO.File.ReadAllLines(csvPath);

            // Split the second row into individual values
            string[] secondRowValues = csvLines[1].Split(',');

            // Define a variable to store the sentence
            double sum = 0;
            int sentence = 0;

            // Parse each value in the second row
            foreach (string val in secondRowValues)
            {
                if(double.TryParse(val, out double parsedValue))
                {
                    sum += parsedValue;
                }

            }

                double average = sum/ secondRowValues.Length;

                if (average > 400)
                {
                    sentence = 0;
                }


                else if (average > 200)
                {
                    sentence = 1;
                }


                else
                {
                    sentence = 2;
                }

                value = sentence;
                avrg = average;
            }</xmp>
            </p>
            
            <div class="container">
    
                    <div class="col-md-6">
                            <img class="min-height" src="static/imgs/week7/igm1.png">
                    </div>

            </div>

            <p> The code above chooses certain sentences to be written based on the average values collected from my potentiometer. Which then is translated into x, y, z coordinates by transforming the words into curves on grasshopper using the following code. <xmp>
             
                if(size == 0)
                size = 1;

            if(!string.IsNullOrEmpty(face) && size > 0 && !string.IsNullOrEmpty(content) &&
                pl.IsValid)
            {

                var te = RhinoDoc.ActiveDoc.Objects.AddText(content, pl, size, face, bold, italics);
                Rhino.DocObjects.TextObject txt = RhinoDoc.ActiveDoc.Objects.Find(te) as Rhino.DocObjects.TextObject;

                if(txt != null)
                {
                var tt = txt.Geometry as Rhino.Geometry.TextEntity;
                A = tt.Explode();
                }

                RhinoDoc.ActiveDoc.Objects.Delete(te, true);
            }
            }</xmp>
            </p>


    
        <div class="col-md-6">
            <img class="max-height" src="/static/imgs/week7/2.png">
        </div>


        </div>

        </div>

   
   
   
        <div class="container">
            <div class="row col">

                <h5>The circuit:</h5>

                <div class="col-md-6">
                        <img class="scaled-down" src="static/imgs/week7/1.jpg">
                </div>

                <div class="col-md-6">
                    <img class="scaled-down" src="static/imgs/week7/3.jpg">
                </div>

                <p>The circuit is made up of a motor driver, a 100 micro-ohms capacitor, and a 12v power source. I began with 1 motor and scaled to two motors. Below is the code used to manipulate both motors:<xmp>
                    #define DIR_PIN1          2
                    #define STEP_PIN1         3
                    #define ENABLE_PIN1       4

                    #define DIR_PIN2          5
                    #define STEP_PIN2         6
                    #define ENABLE_PIN2       7

                    void setup() {
                    pinMode(STEP_PIN1,   OUTPUT);
                    pinMode(DIR_PIN1,    OUTPUT);
                    pinMode(ENABLE_PIN1, OUTPUT);

                    pinMode(STEP_PIN2,   OUTPUT);
                    pinMode(DIR_PIN2,    OUTPUT);
                    pinMode(ENABLE_PIN2, OUTPUT);
                    }

                    #define STEPS 150
                    #define DELAY_FACTOR 1.5

                    void constantAccel(int stepPin) {
                    int delays[STEPS];
                    float angle = 1;
                    float accel = 0.01;
                    float c0 = 2000 * sqrt( 2 * angle / accel ) * 0.67703;
                    float lastDelay = 0;
                    int highSpeed = 100;
                    for (int i = 0; i < STEPS; i++) {
                        float d = c0;
                        if ( i > 0 )
                        d = lastDelay - (2 * lastDelay) / (4 * i + 1);
                        if ( d < highSpeed )
                        d = highSpeed;
                        delays[i] = d * DELAY_FACTOR;
                        lastDelay = d;
                    }

                    // use delays from the array, forward
                    for (int i = 0; i < STEPS; i++) {
                        digitalWrite(stepPin, HIGH);
                        delayMicroseconds( delays[i] );
                        digitalWrite(stepPin, LOW);
                    }

                    // use delays from the array, backward
                    for (int i = 0; i < STEPS; i++) {
                    digitalWrite(stepPin, HIGH);
                    delayMicroseconds( delays[STEPS-i-1] );
                    digitalWrite(stepPin, LOW);
                    }

                    
                    }

                    void loop() {

                    
                    // Motor 2 forward
                    digitalWrite(DIR_PIN2, LOW);
                    constantAccel(STEP_PIN2);


                    // Motor 1 forward - y-axis
                    digitalWrite(DIR_PIN1, LOW);
                    constantAccel(STEP_PIN1);


                    //Motor 2 backward - x axis 
                    digitalWrite(DIR_PIN2, HIGH);
                    constantAccel(STEP_PIN2);

                    // Motor 1 backward
                    digitalWrite(DIR_PIN1, HIGH);
                    constantAccel(STEP_PIN1);


                    while (true);
                    }

                </xmp>
                </p>

            </div>
        </div>
        


        <div class="container">
            <div class="row col d-flex align-items-stretch">

                <h5>Simple motions</h5>
                
                <video width="640" height="600" controls autoplay>
                    <source src="static/imgs/week7/1.mp4" type="video/mp4">
                    Your browser does not support the video tag.
                </video>  
                
                </div>
            </div>

        </div>

        <div class="container">
            <div class="row col d-flex align-items-stretch">

                <h5></h5>
                
                <video width="640" height="600" controls autoplay>
                    <source src="static/imgs/week7/2.mp4" type="video/mp4">
                    Your browser does not support the video tag.
                </video>  
                
                </div>
            </div>

        </div>


        <div class="container">
            <div class="row col d-flex align-items-stretch">
            </div>

        </div>




        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.bundle.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.8.2/js/lightbox.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.11.6/umd/popper.min.js" integrity="sha384-..." crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-..." crossorigin="anonymous"></script>


    </body>

  

</html>